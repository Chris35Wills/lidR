<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="css/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="css/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

  </head>

  <body>
    <header>
      <div class="inner">
        <a href="/lidR"><h1>lidR</h1></a>
        <h2>R package for airborne LiDAR data manipulation and visualisation for forestry applications</h2>
        <a href="https://github.com/Jean-Romain/lidR" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">


    <h1>Common miss usage of gridMetrics</h1>

    <p>The user can miss use the <code class="highlighter-rouge">gridMetrics</code> function by using a function which is not appropriated. For example these examples are not allowed:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>gridMetrics(lidar, 20, LAD(Z))
gridMetrics(lidar, 20, head(Z))
gridMetrics(lidar, 20, range(Intensity))
gridMetrics(lidar, 20, quantile(Z))
</code></pre>
</div>

<ol>
  <li><code class="highlighter-rouge">LAD</code> returns a <code class="highlighter-rouge">data.frame</code>.</li>
  <li><code class="highlighter-rouge">head</code>returns a  <code class="highlighter-rouge">vector</code></li>
  <li><code class="highlighter-rouge">range</code>returns a <code class="highlighter-rouge">vector</code></li>
  <li><code class="highlighter-rouge">quantile</code>returns a <code class="highlighter-rouge">vector</code></li>
</ol>

<p>The expression provided to <code class="highlighter-rouge">gridMetrics</code> must return a single number or a <code class="highlighter-rouge">list</code> of single numbers. If it is not the case, the function will crash and the error given by the <code class="highlighter-rouge">data.table</code> is inapprehensible for users.</p>

<h2 id="example-of-quantiles">Example of quantiles</h2>

<p>By defining a new quantile function which call the original on you can change the output type. And you can choose the names of the outputs renaming the list.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>myQuantile = function(x, probs = seq(0, 1, 0.25))
{
    q = quantile(x, probs)
    q = as.list(q)
    names(q) = paste("q", probs*100, sep="")
    return(q)
}
</code></pre>
</div>

<p>Then use this function. This the basic way <code class="highlighter-rouge">gridMetrics</code> works.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>metrics = gridMetrics(lidar, 20, myQuantile(Z))
head(metrics)

        X       Y   q0   q25   q50     q75  q100
1: 685310 5017810 0.00 2.020 5.715 10.3325 18.59
2: 685310 5017790 0.32 0.320 0.320  0.3200  0.32
3: 685330 5017790 0.00 0.000 0.185  3.2500 11.71
4: 685330 5017810 0.00 0.290 3.710  6.7600 19.19
5: 685350 5017790 0.00 0.285 5.540  8.9750 14.67
6: 685350 5017810 0.00 2.880 6.980  9.9200 15.21
</code></pre>
</div>

<p>You can use it with optionnal arguments.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>metrics = gridMetrics(lidar, 20, myQuantile(Z, seq(0.1,0.9,0.1)))
hean(metrics)

        X       Y  q10   q20   q30   q40   q50   q60   q70    q80    q90
1: 685310 5017810 0.00 0.516 3.030 4.160 5.715 7.428 9.292 11.480 14.093
2: 685310 5017790 0.32 0.320 0.320 0.320 0.320 0.320 0.320  0.320  0.320
3: 685330 5017790 0.00 0.000 0.020 0.082 0.185 0.400 1.127  5.162  7.500
4: 685330 5017810 0.06 0.230 0.430 2.170 3.710 4.920 6.020  7.650 10.630
5: 685350 5017790 0.00 0.120 1.590 3.600 5.540 6.560 8.390  9.800 11.420
6: 685350 5017810 0.11 0.512 4.202 5.830 6.980 7.870 9.210 10.490 11.652
</code></pre>
</div>

<h2 id="common-error">Common error</h2>

<div class="highlighter-rouge"><pre class="highlight"><code> gridMetrics(lidar, 20, LAD(Z))
</code></pre>
</div>

<blockquote>
  <p>&gt; Erreur : The expression ‘LAD(Z)’ returned a data.frame. A single number or a list of single number is expected.</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code> gridMetrics(lidar, 20, quantile(Z))
</code></pre>
</div>

<blockquote>
  <p>&gt; Erreur : The expression ‘quantile(Z)’ returned a vector of lenght  5. A single number or a list of single number is expected.</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code>myMetrics = function(z, i, angle, pulseID)
{
   ret = list(
         npulse  = length(unique(pulseID)),
         hmean   = mean(z),
         hmax    = max(z),
         lad     = LAD(Z),
         iq      = quantile(i))
  
   return(ret)
}
  
metrics = gridMetrics(lidar, 20, myMetrics(Z, Intensity, ScanAngle, pulseID))
</code></pre>
</div>

<blockquote>
  <p>&gt; Erreur : The expression ‘myMetrics(Z, Intensity, ScanAngle, pulseID)’ returned a list in which all elements are not a single numeric or logical value. The metric lad is a data.frame.</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code>myMetrics = function(z, i, angle, pulseID)
{
   ret = list(
         npulse  = length(unique(pulseID)),
         hmean   = mean(z),
         hmax    = max(z),
         iq      = quantile(i))
  
   return(ret)
}
  
metrics = gridMetrics(lidar, 20, myMetrics(Z, Intensity, ScanAngle, pulseID))
</code></pre>
</div>

<blockquote>
  <p>&gt;  Erreur : The expression ‘myMetrics(Z, Intensity, ScanAngle, pulseID)’ returned a list in which all elements are not a single value. The metric iq has a length of 5.</p>
</blockquote>


</section>

        <aside id="sidebar">
          <a href="https://github.com/Jean-Romain/lidR/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/Jean-Romain/lidR/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/Jean-Romain/lidR"></a> is maintained by <a href="https://github.com/Jean-Romain">Jean-Romain</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>

